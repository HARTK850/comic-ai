<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחולל קומיקס עם AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap');
        
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f8fafc;
        }
        
        .comic-panel {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .comic-panel:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .comic-bubble {
            position: relative;
            background: white;
            border-radius: 1em;
            padding: 1em;
            margin: 1em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .comic-bubble:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 20px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: white transparent;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #6b46c1 0%, #805ad5 50%, #9f7aea 100%);
        }
        
        .floating-btn {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Animation for comic generation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #9f7aea;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #805ad5;
        }
        
        /* RTL fixes for Tailwind */
        .rtl-grid {
            direction: rtl;
        }
        
        .rtl-text {
            direction: rtl;
            text-align: right;
        }
    </style>
</head>
<body class="rtl-text">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-book-open fa-2x"></i>
                    <h1 class="text-3xl font-bold">מחולל קומיקס עם AI</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="help-btn" class="bg-white text-purple-700 px-4 py-2 rounded-full font-medium hover:bg-purple-100 transition">
                        <i class="fas fa-question-circle mr-2"></i>עזרה
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- API Key Section -->
        <section class="mb-12 bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4 text-purple-800">
                <i class="fas fa-key mr-2"></i>הגדרות API
            </h2>
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <label for="api-key" class="block text-sm font-medium text-gray-700 mb-1">מפתח API של DeepAI</label>
                    <div class="flex">
                        <input type="password" id="api-key" placeholder="הכנס את מפתח ה-API שלך" 
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-l-md focus:ring-purple-500 focus:border-purple-500">
                        <button id="toggle-api-key" class="bg-gray-200 px-3 border border-gray-300 rounded-r-md">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <p class="mt-2 text-sm text-gray-500">
                        ניתן לקבל מפתח API חינמי מאתר <a href="https://deepai.org/" target="_blank" class="text-purple-600 hover:underline">DeepAI</a>
                    </p>
                </div>
                <div class="flex items-end">
                    <button id="save-api-key" class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
                        <i class="fas fa-save mr-2"></i>שמור מפתח
                    </button>
                </div>
            </div>
        </section>

        <!-- Story Input Section -->
        <section class="mb-12 bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4 text-purple-800">
                <i class="fas fa-book-open mr-2"></i>יצירת הסיפור
            </h2>
            
            <div class="mb-6">
                <div class="flex space-x-4 mb-4">
                    <button id="manual-story-btn" class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition">
                        <i class="fas fa-pen mr-2"></i>כתוב סיפור ידנית
                    </button>
                    <button id="ai-story-btn" class="px-4 py-2 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 transition">
                        <i class="fas fa-robot mr-2"></i>צור סיפור עם AI
                    </button>
                </div>
                
                <!-- Manual Story Input -->
                <div id="manual-story-section" class="mt-4">
                    <label for="story-input" class="block text-sm font-medium text-gray-700 mb-1">הכנס את הסיפור שלך (בעברית או אנגלית)</label>
                    <textarea id="story-input" rows="6" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500" 
                        placeholder="כתוב כאן את הסיפור שלך..."></textarea>
                </div>
                
                <!-- AI Story Options -->
                <div id="ai-story-section" class="mt-4 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="story-genre" class="block text-sm font-medium text-gray-700 mb-1">ז'אנר הסיפור</label>
                            <select id="story-genre" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                                <option value="הרפתקאות">הרפתקאות</option>
                                <option value="מדע בדיוני">מדע בדיוני</option>
                                <option value="פנטזיה">פנטזיה</option>
                                <option value="מסתורין">מסתורין</option>
                                <option value="רומנטיקה">רומנטיקה</option>
                                <option value="קומדיה">קומדיה</option>
                                <option value="אימה">אימה</option>
                                <option value="היסטורי">היסטורי</option>
                            </select>
                        </div>
                        <div>
                            <label for="story-length" class="block text-sm font-medium text-gray-700 mb-1">אורך הסיפור</label>
                            <select id="story-length" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                                <option value="קצר">קצר (2-3 משפטים)</option>
                                <option value="בינוני">בינוני (4-6 משפטים)</option>
                                <option value="ארוך">ארוך (7-10 משפטים)</option>
                            </select>
                        </div>
                        <div>
                            <label for="story-theme" class="block text-sm font-medium text-gray-700 mb-1">נושא מרכזי</label>
                            <input type="text" id="story-theme" placeholder="לדוגמה: גיבור על, מסע בזמן" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        <div>
                            <label for="story-characters" class="block text-sm font-medium text-gray-700 mb-1">דמויות</label>
                            <input type="text" id="story-characters" placeholder="לדוגמה: ילדה אמיצה, רובוט חכם" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        </div>
                    </div>
                    
                    <button id="generate-story-btn" class="mt-6 bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
                        <i class="fas fa-magic mr-2"></i>צור סיפור עם AI
                    </button>
                </div>
            </div>
        </section>

        <!-- Comic Generation Options -->
        <section class="mb-12 bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4 text-purple-800">
                <i class="fas fa-cog mr-2"></i>אפשרויות יצירת הקומיקס
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="comic-style" class="block text-sm font-medium text-gray-700 mb-1">סגנון הקומיקס</label>
                    <select id="comic-style" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        <option value="קלאסי">קלאסי</option>
                        <option value="מנגה">מנגה</option>
                        <option value="סופר-גיבור">סופר-גיבור</option>
                        <option value="ריאליסטי">ריאליסטי</option>
                        <option value="קריקטורה">קריקטורה</option>
                        <option value="פנטזיה">פנטזיה</option>
                    </select>
                </div>
                <div>
                    <label for="panel-count" class="block text-sm font-medium text-gray-700 mb-1">מספר פאנלים</label>
                    <select id="panel-count" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        <option value="4">4</option>
                        <option value="6">6</option>
                        <option value="8">8</option>
                        <option value="12">12</option>
                    </select>
                </div>
                <div>
                    <label for="color-scheme" class="block text-sm font-medium text-gray-700 mb-1">סגנון צבע</label>
                    <select id="color-scheme" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500">
                        <option value="צבעוני">צבעוני</option>
                        <option value="שחור-לבן">שחור-לבן</option>
                        <option value="גווני אפור">גווני אפור</option>
                        <option value="רטרו">רטרו</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">אפשרויות נוספות</label>
                <div class="flex flex-wrap gap-4">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="add-speech-bubbles" checked class="rounded text-purple-600 focus:ring-purple-500">
                        <span class="mr-2">הוסף בועות דיבור</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="add-captions" checked class="rounded text-purple-600 focus:ring-purple-500">
                        <span class="mr-2">הוסף כיתובים</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="add-sound-effects" class="rounded text-purple-600 focus:ring-purple-500">
                        <span class="mr-2">הוסף אפקטי קול</span>
                    </label>
                </div>
            </div>
            
            <button id="generate-comic-btn" class="mt-6 bg-purple-600 text-white px-8 py-3 rounded-md hover:bg-purple-700 transition font-bold text-lg">
                <i class="fas fa-bolt mr-2"></i>צור קומיקס!
            </button>
        </section>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-xl text-center max-w-md">
                <div class="loading-spinner text-purple-600 text-5xl mb-4">
                    <i class="fas fa-spinner"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">יוצר את הקומיקס שלך...</h3>
                <p class="text-gray-600">תהליך היצירה עשוי לקחת מספר דקות. אנא המתן.</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                    <div id="progress-bar" class="bg-purple-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <section id="results-section" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-purple-800">
                    <i class="fas fa-images mr-2"></i>הקומיקס שלך
                </h2>
                <div class="flex space-x-2">
                    <button id="export-pdf-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">
                        <i class="fas fa-file-pdf mr-2"></i>ייצא ל-PDF
                    </button>
                    <button id="export-png-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition">
                        <i class="fas fa-image mr-2"></i>ייצא כתמונה
                    </button>
                    <button id="share-comic-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition">
                        <i class="fas fa-share-alt mr-2"></i>שתף
                    </button>
                </div>
            </div>
            
            <div id="comic-container" class="bg-white p-6 rounded-xl shadow-md">
                <!-- Comic will be generated here -->
            </div>
            
            <div class="mt-6 bg-white p-6 rounded-xl shadow-md">
                <h3 class="text-xl font-bold mb-4 text-purple-800">
                    <i class="fas fa-lightbulb mr-2"></i>עריכה מתקדמת
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ערוך פאנלים</label>
                        <div class="flex flex-wrap gap-2">
                            <button id="add-panel-btn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">
                                <i class="fas fa-plus mr-1"></i>הוסף פאנל
                            </button>
                            <button id="remove-panel-btn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">
                                <i class="fas fa-minus mr-1"></i>הסר פאנל
                            </button>
                            <button id="rearrange-panels-btn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">
                                <i class="fas fa-arrows-alt mr-1"></i>סדר מחדש
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ערוך טקסט</label>
                        <div class="flex flex-wrap gap-2">
                            <button id="edit-text-btn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">
                                <i class="fas fa-edit mr-1"></i>ערוך טקסט
                            </button>
                            <button id="change-font-btn" class="bg-gray-200 text-gray-700 px-3 py-1 rounded-md hover:bg-gray-300 transition">
                                <i class="fas fa-font mr-1"></i>שנה גופן
                            </button>
                        </div>
                    </div>
                </div>
                
                <button id="regenerate-comic-btn" class="mt-6 bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition">
                    <i class="fas fa-sync-alt mr-2"></i>צור מחדש עם שינויים
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-xl font-bold flex items-center">
                        <i class="fas fa-book-open mr-2"></i>מחולל קומיקס עם AI
                    </h2>
                    <p class="mt-2">הכלי המושלם ליצירת קומיקס אישי עם בינה מלאכותית</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="hover:text-purple-200 transition">
                        <i class="fab fa-facebook-f fa-lg"></i>
                    </a>
                    <a href="#" class="hover:text-purple-200 transition">
                        <i class="fab fa-twitter fa-lg"></i>
                    </a>
                    <a href="#" class="hover:text-purple-200 transition">
                        <i class="fab fa-instagram fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-purple-400 text-center text-sm">
                <p>© 2023 מחולל קומיקס עם AI. כל הזכויות שמורות.</p>
            </div>
        </div>
    </footer>

    <!-- Help Modal -->
    <div id="help-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">
                    <i class="fas fa-question-circle mr-2"></i>עזרה ומדריך
                </h3>
                <button id="close-help-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <h4 class="text-lg font-bold mb-2 text-purple-700">איך להשתמש במחולל הקומיקס</h4>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li>השג מפתח API חינמי מאתר DeepAI והכנס אותו בשדה המתאים</li>
                        <li>בחר אם לכתוב סיפור ידנית או ליצור אחד עם AI</li>
                        <li>אם בחרת ב-AI, הגדר את הפרמטרים הרצויים לך לסיפור</li>
                        <li>בחר את סגנון הקומיקס והאפשרויות הרצויות לך</li>
                        <li>לחץ על "צור קומיקס!" והמתן לתוצאות</li>
                        <li>לאחר היצירה, תוכל לערוך, לייצא או לשתף את הקומיקס שלך</li>
                    </ol>
                </div>
                
                <div>
                    <h4 class="text-lg font-bold mb-2 text-purple-700">שאלות נפוצות</h4>
                    <div class="space-y-4">
                        <div>
                            <h5 class="font-medium">איך משיגים מפתח API של DeepAI?</h5>
                            <p class="text-gray-600 mt-1">ניתן ליצור חשבון חינמי ב-<a href="https://deepai.org/" target="_blank" class="text-purple-600 hover:underline">DeepAI</a> ולקבל מפתח API בדף ההגדרות של החשבון שלך.</p>
                        </div>
                        <div>
                            <h5 class="font-medium">כמה זמן לוקח ליצור קומיקס?</h5>
                            <p class="text-gray-600 mt-1">תהליך היצירה יכול לקחת בין 2-5 דקות, תלוי במורכבות הסיפור ובמספר הפאנלים.</p>
                        </div>
                        <div>
                            <h5 class="font-medium">האם יש הגבלה על מספר הקומיקסים שאוכל ליצור?</h5>
                            <p class="text-gray-600 mt-1">הגבלת השימוש תלויה בתוכנית ה-API שלך ב-DeepAI. בחשבון חינמי יש בדרך כלל הגבלה יומית.</p>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-bold mb-2 text-purple-700">טיפים ליצירת קומיקס טוב יותר</h4>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li>השתמש בתיאורים מפורטים בסיפור שלך כדי לקבל תוצאות מדויקות יותר</li>
                        <li>נסה סגנונות שונים של קומיקס כדי לראות מה הכי מתאים לסיפור שלך</li>
                        <li>אם התוצאה לא מושלמת, נסה לערוך את הסיפור ולצור מחדש</li>
                        <li>השתמש באפשרויות העריכה כדי להתאים אישית את הקומיקס לאחר היצירה</li>
                    </ul>
                </div>
            </div>
            
            <button id="close-help-modal-btn" class="mt-6 bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition w-full">
                סגור
            </button>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-purple-800">
                    <i class="fas fa-share-alt mr-2"></i>שתף את הקומיקס שלך
                </h3>
                <button id="close-share-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">קישור לשיתוף</label>
                    <div class="flex">
                        <input type="text" id="share-link" readonly 
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-l-md bg-gray-100">
                        <button id="copy-share-link" class="bg-purple-600 text-white px-4 py-2 rounded-r-md hover:bg-purple-700 transition">
                            העתק
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">שתף בפלטפורמות</label>
                    <div class="flex justify-center space-x-4">
                        <button class="bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600 transition">
                            <i class="fab fa-facebook-f fa-lg"></i>
                        </button>
                        <button class="bg-blue-400 text-white p-3 rounded-full hover:bg-blue-500 transition">
                            <i class="fab fa-twitter fa-lg"></i>
                        </button>
                        <button class="bg-pink-600 text-white p-3 rounded-full hover:bg-pink-700 transition">
                            <i class="fab fa-instagram fa-lg"></i>
                        </button>
                        <button class="bg-green-500 text-white p-3 rounded-full hover:bg-green-600 transition">
                            <i class="fab fa-whatsapp fa-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <button id="close-share-modal-btn" class="mt-6 bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition w-full">
                סגור
            </button>
        </div>
    </div>

    <script>
        // Initialize variables
        let apiKey = '';
        let generatedStory = '';
        let comicPanels = [];
        
        // DOM Elements
        const apiKeyInput = document.getElementById('api-key');
        const toggleApiKeyBtn = document.getElementById('toggle-api-key');
        const saveApiKeyBtn = document.getElementById('save-api-key');
        const manualStoryBtn = document.getElementById('manual-story-btn');
        const aiStoryBtn = document.getElementById('ai-story-btn');
        const manualStorySection = document.getElementById('manual-story-section');
        const aiStorySection = document.getElementById('ai-story-section');
        const generateStoryBtn = document.getElementById('generate-story-btn');
        const generateComicBtn = document.getElementById('generate-comic-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const progressBar = document.getElementById('progress-bar');
        const resultsSection = document.getElementById('results-section');
        const comicContainer = document.getElementById('comic-container');
        const helpBtn = document.getElementById('help-btn');
        const helpModal = document.getElementById('help-modal');
        const closeHelpModal = document.getElementById('close-help-modal');
        const closeHelpModalBtn = document.getElementById('close-help-modal-btn');
        const shareComicBtn = document.getElementById('share-comic-btn');
        const shareModal = document.getElementById('share-modal');
        const closeShareModal = document.getElementById('close-share-modal');
        const closeShareModalBtn = document.getElementById('close-share-modal-btn');
        const exportPdfBtn = document.getElementById('export-pdf-btn');
        const exportPngBtn = document.getElementById('export-png-btn');
        const copyShareLink = document.getElementById('copy-share-link');
        const shareLink = document.getElementById('share-link');
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved API key if exists
            const savedApiKey = localStorage.getItem('deepai_api_key');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
                apiKey = savedApiKey;
            }
        });
        
        toggleApiKeyBtn.addEventListener('click', () => {
            if (apiKeyInput.type === 'password') {
                apiKeyInput.type = 'text';
                toggleApiKeyBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                apiKeyInput.type = 'password';
                toggleApiKeyBtn.innerHTML = '<i class="fas fa-eye"></i>';
            }
        });
        
        saveApiKeyBtn.addEventListener('click', () => {
            apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('deepai_api_key', apiKey);
                showToast('מפתח API נשמר בהצלחה!', 'success');
            } else {
                showToast('אנא הכנס מפתח API תקין', 'error');
            }
        });
        
        manualStoryBtn.addEventListener('click', () => {
            manualStoryBtn.classList.remove('bg-purple-100', 'text-purple-700');
            manualStoryBtn.classList.add('bg-purple-600', 'text-white');
            aiStoryBtn.classList.remove('bg-purple-600', 'text-white');
            aiStoryBtn.classList.add('bg-purple-100', 'text-purple-700');
            manualStorySection.classList.remove('hidden');
            aiStorySection.classList.add('hidden');
        });
        
        aiStoryBtn.addEventListener('click', () => {
            aiStoryBtn.classList.remove('bg-purple-100', 'text-purple-700');
            aiStoryBtn.classList.add('bg-purple-600', 'text-white');
            manualStoryBtn.classList.remove('bg-purple-600', 'text-white');
            manualStoryBtn.classList.add('bg-purple-100', 'text-purple-700');
            manualStorySection.classList.add('hidden');
            aiStorySection.classList.remove('hidden');
        });
        
        generateStoryBtn.addEventListener('click', async () => {
            if (!apiKey) {
                showToast('אנא הכנס מפתח API תחילה', 'error');
                return;
            }
            
            const genre = document.getElementById('story-genre').value;
            const length = document.getElementById('story-length').value;
            const theme = document.getElementById('story-theme').value;
            const characters = document.getElementById('story-characters').value;
            
            if (!theme || !characters) {
                showToast('אנא מלא את כל השדות הדרושים', 'error');
                return;
            }
            
            loadingIndicator.classList.remove('hidden');
            progressBar.style.width = '30%';
            
            try {
                // Simulate API call to generate story (in a real app, this would call DeepAI API)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Sample generated stories based on genre
                const stories = {
                    'הרפתקאות': `בלב הג'ונגל האמזוני, ליאור הצעיר גילה עיר אבודה מלאה באוצרות עתיקים. אך כשניסה לקחת פסלון זהב, הרצפה החלה לרעוד ומלכודות החלו להיפתח. עם חברתו רוני והמדריך המקומי קרלוס, הם נאלצים לברוח תוך כדי פתרון חידות עתיקות וחציית גשרים מסוכנים. האם יצליחו לצאת לפני שהעיר תיעלם שוב לעד?`,
                    'מדע בדיוני': `בשנת 3023, ד"ר תמר כהן פיתחה מכונת זמן המבוססת על קריסטלים קוונטיים. כשניסתה לחזור לעבר כדי למנוע את אסון האקלים, גילתה שהעתיד השתנה בצורה מפחידה - האנושות נכחדה והוחלפה ברובוטים חסרי רגש. עם עוזרה הרובוטי ZX-7, היא חייבת לתקן את ציר הזמן לפני שיהיה מאוחר מדי.`,
                    'פנטזיה': `נועה בת ה-12 גילתה שהיא היורשת האחרונה של מסדר הקוסמים העתיק. עם דרקון קטן בשפי שנשבע להגן עליה, היא יוצאת למסע להחזיר את הקסם לעולם שהשתכנע שהוא אגדה. אך הקוסם האפל מורדוך וצבא הצללים שלו עוקבים אחריה, נחושים למנוע ממנה להגיע למגדל האור לפני ליקוי הירח הכחול.`,
                    'מסתורין': `כשהסופר המפורסם איתן לוי נמצא מת בחדר העבודה הנעול שלו, הבלשית מיכל אשכנזי מגלה שהרמזים מובילים לרומן הבלתי גמור שלו. כל פרק מכיל רמזים לחייו האפלים ולסודות ששמר מכל העולם. כשמיכל מתקרבת לאמת, מישהו עוקב אחריה, נחוש לשמור שהסיפור האמיתי לעולם לא ייחשף.`,
                    'רומנטיקה': `אחרי פרידה כואבת, נועם עובר לתל אביב ומתחיל עבודה חדשה בקפה קטן. שם הוא פוגש את שירה, בריסטית מסתורית עם עבר כואב משלה. למרות הניסיון של שניהם לא להתקרב, הקשר ביניהם גדל עם כל כוס קפה ושיחה עד השעות הקטנות של הלילה. אך כשסודות העבר צפים, האם האהבה תצליח לגבור על הפחדים?`,
                    'קומדיה': `כשדניאל וטל מחליטים לפתוח מסעדה יחד, אף אחד לא יכול היה לנחש את הכאוס שיבוא. מהשף שטוען שהוא יכול לבשל רק אם שרים לו, דרך המלצרית שמאמינה שהיא נבואה, ועד לחתול המקומי שמשתלט על המטבח - כל יום הוא הרפתקה חדשה. וכשמבקר המסעדות המפורסם מגיע, הם מבינים שזה הרגע להצליח... או להיכשל בגדול.`,
                    'אימה': `כשמיכל עוברת לבית החדש בעיירה נידחת, היא מבחינה שהשכנים תמיד נעלמים אחרי מסיבת יום ההולדת השנתית שלהם. כשמתחילה לחקור, היא מגלה שהעיירה כולה משתתפת בטקס עתיק שדורש קורבן כל שנה. עכשיו, כשהמסיבה מתקרבת, מיכל מבינה שהיא הבאה בתור - אלא אם תצליח לברוח לפני שהשעון יחצה את חצות.`,
                    'היסטורי': `ירושלים, 1947. יוסף, ארכיאולוג צעיר, מגלה מגילה עתיקה החושפת מיקום של אוצר מהמקדש הראשון. בעודו מנסה לפענח את הרמזים, הוא נקלע למאבק בין הבריטים, היהודים והערבים על עתיד הארץ. עם אהבתו האסורה לבתו של המופתי וקשריו עם המחתרות, יוסף מוצא את עצמו במרכז האירועים שישנו את ההיסטוריה.`
                };
                
                generatedStory = stories[genre] || stories['הרפתקאות'];
                document.getElementById('story-input').value = generatedStory;
                
                progressBar.style.width = '100%';
                showToast('הסיפור נוצר בהצלחה!', 'success');
            } catch (error) {
                console.error('Error generating story:', error);
                showToast('שגיאה ביצירת הסיפור', 'error');
            } finally {
                setTimeout(() => {
                    loadingIndicator.classList.add('hidden');
                    progressBar.style.width = '0%';
                }, 500);
            }
        });
        
        generateComicBtn.addEventListener('click', async () => {
            if (!apiKey) {
                showToast('אנא הכנס מפתח API תחילה', 'error');
                return;
            }
            
            const storyInput = document.getElementById('story-input').value.trim();
            if (!storyInput) {
                showToast('אנא כתוב סיפור או צור אחד עם AI', 'error');
                return;
            }
            
            const comicStyle = document.getElementById('comic-style').value;
            const panelCount = parseInt(document.getElementById('panel-count').value);
            const colorScheme = document.getElementById('color-scheme').value;
            const addSpeechBubbles = document.getElementById('add-speech-bubbles').checked;
            const addCaptions = document.getElementById('add-captions').checked;
            const addSoundEffects = document.getElementById('add-sound-effects').checked;
            
            loadingIndicator.classList.remove('hidden');
            progressBar.style.width = '10%';
            
            try {
                // Simulate API call to generate comic (in a real app, this would call DeepAI API)
                await new Promise(resolve => setTimeout(() => {
                    progressBar.style.width = '40%';
                    setTimeout(resolve, 1500);
                }, 1500));
                
                // Split story into parts for each panel
                const sentences = storyInput.split(/[.!?]+/).filter(s => s.trim().length > 0);
                const panels = [];
                
                for (let i = 0; i < panelCount; i++) {
                    const sentenceIndex = Math.floor((i / panelCount) * sentences.length);
                    const panelText = sentences[sentenceIndex] || "המשך הסיפור...";
                    
                    panels.push({
                        id: i + 1,
                        text: panelText.trim(),
                        // In a real app, this would be the image URL from DeepAI
                        imageUrl: `https://picsum.photos/500/300?random=${i}&grayscale=${colorScheme === 'שחור-לבן' ? '1' : '0'}`,
                        caption: addCaptions ? `פאנל ${i + 1}` : '',
                        speechBubble: addSpeechBubbles ? panelText.trim() : ''
                    });
                }
                
                comicPanels = panels;
                progressBar.style.width = '80%';
                
                // Render comic
                renderComic(panels, comicStyle, colorScheme, addSoundEffects);
                
                progressBar.style.width = '100%';
                showToast('הקומיקס נוצר בהצלחה!', 'success');
                resultsSection.classList.remove('hidden');
                
                // Scroll to results
                setTimeout(() => {
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                }, 500);
            } catch (error) {
                console.error('Error generating comic:', error);
                showToast('שגיאה ביצירת הקומיקס', 'error');
            } finally {
                setTimeout(() => {
                    loadingIndicator.classList.add('hidden');
                    progressBar.style.width = '0%';
                }, 500);
            }
        });
        
        helpBtn.addEventListener('click', () => {
            helpModal.classList.remove('hidden');
        });
        
        closeHelpModal.addEventListener('click', () => {
            helpModal.classList.add('hidden');
        });
        
        closeHelpModalBtn.addEventListener('click', () => {
            helpModal.classList.add('hidden');
        });
        
        shareComicBtn.addEventListener('click', () => {
            shareModal.classList.remove('hidden');
            shareLink.value = `${window.location.origin}${window.location.pathname}?comic=${btoa(JSON.stringify(comicPanels))}`;
        });
        
        closeShareModal.addEventListener('click', () => {
            shareModal.classList.add('hidden');
        });
        
        closeShareModalBtn.addEventListener('click', () => {
            shareModal.classList.add('hidden');
        });
        
        copyShareLink.addEventListener('click', () => {
            shareLink.select();
            document.execCommand('copy');
            showToast('הקישור הועתק!', 'success');
        });
        
        exportPdfBtn.addEventListener('click', async () => {
            loadingIndicator.classList.remove('hidden');
            progressBar.style.width = '30%';
            
            try {
                // Simulate PDF generation
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // In a real app, use jsPDF to create PDF
                showToast('PDF נוצר והורד בהצלחה!', 'success');
            } catch (error) {
                console.error('Error generating PDF:', error);
                showToast('שגיאה ביצירת PDF', 'error');
            } finally {
                loadingIndicator.classList.add('hidden');
                progressBar.style.width = '0%';
            }
        });
        
        exportPngBtn.addEventListener('click', async () => {
            loadingIndicator.classList.remove('hidden');
            progressBar.style.width = '30%';
            
            try {
                // Use html2canvas to capture comic as image
                const canvas = await html2canvas(document.getElementById('comic-container'));
                const imgData = canvas.toDataURL('image/png');
                
                const link = document.createElement('a');
                link.download = 'comic.png';
                link.href = imgData;
                link.click();
                
                showToast('תמונת הקומיקס הורדה בהצלחה!', 'success');
            } catch (error) {
                console.error('Error generating PNG:', error);
                showToast('שגיאה ביצירת תמונה', 'error');
            } finally {
                loadingIndicator.classList.add('hidden');
                progressBar.style.width = '0%';
            }
        });
        
        // Helper Functions
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-md shadow-lg text-white font-medium ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function renderComic(panels, style, colorScheme, soundEffects) {
            comicContainer.innerHTML = '';
            
            // Create comic title
            const title = document.createElement('h3');
            title.className = 'text-xl font-bold mb-6 text-center text-purple-800';
            title.textContent = 'הקומיקס שלי';
            comicContainer.appendChild(title);
            
            // Create comic grid based on panel count
            const gridClasses = {
                4: 'grid-cols-1 md:grid-cols-2',
                6: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
                8: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4',
                12: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4'
            };
            
            const grid = document.createElement('div');
            grid.className = `grid ${gridClasses[panels.length]} gap-6 rtl-grid`;
            comicContainer.appendChild(grid);
            
            // Add each panel to the grid
            panels.forEach((panel, index) => {
                const panelDiv = document.createElement('div');
                panelDiv.className = `comic-panel bg-white rounded-lg overflow-hidden shadow-md animate-fade-in`;
                panelDiv.style.animationDelay = `${index * 0.1}s`;
                
                // Panel image
                const imgDiv = document.createElement('div');
                imgDiv.className = 'relative';
                
                const img = document.createElement('img');
                img.src = panel.imageUrl;
                img.alt = `פאנל ${panel.id}`;
                img.className = 'w-full h-48 object-cover';
                img.loading = 'lazy';
                imgDiv.appendChild(img);
                
                // Sound effect (random)
                if (soundEffects && Math.random() > 0.7) {
                    const soundEffectsList = ['בום!', 'פווייש!', 'קראאאק!', 'זום!', 'שאקקק!', 'ווש!'];
                    const randomEffect = soundEffectsList[Math.floor(Math.random() * soundEffectsList.length)];
                    
                    const soundEffect = document.createElement('div');
                    soundEffect.className = 'absolute top-2 left-2 bg-yellow-400 text-black font-bold px-3 py-1 rounded-full text-sm transform rotate-12';
                    soundEffect.textContent = randomEffect;
                    imgDiv.appendChild(soundEffect);
                }
                
                panelDiv.appendChild(imgDiv);
                
                // Panel content
                const contentDiv = document.createElement('div');
                contentDiv.className = 'p-4';
                
                // Caption
                if (panel.caption) {
                    const caption = document.createElement('div');
                    caption.className = 'text-xs font-bold text-gray-500 mb-2';
                    caption.textContent = panel.caption;
                    contentDiv.appendChild(caption);
                }
                
                // Speech bubble
                if (panel.speechBubble) {
                    const bubble = document.createElement('div');
                    bubble.className = 'comic-bubble text-sm mb-3';
                    bubble.textContent = panel.speechBubble;
                    contentDiv.appendChild(bubble);
                }
                
                panelDiv.appendChild(contentDiv);
                grid.appendChild(panelDiv);
            });
            
            // Add comic footer
            const footer = document.createElement('div');
            footer.className = 'mt-6 text-center text-sm text-gray-500';
            footer.textContent = `נוצר עם מחולל הקומיקס של AI | סגנון: ${style} | ${new Date().toLocaleDateString('he-IL')}`;
            comicContainer.appendChild(footer);
        }
    </script>
</body>
</html>
